Fluxo ‚ÄúAuthorization Code + PKCE‚Äù (o certo em 2026)

1Ô∏è‚É£ Usu√°rio acessa /login
2Ô∏è‚É£ Seu backend redireciona para o IdP
3Ô∏è‚É£ Usu√°rio faz login no IdP (senha, MFA, Google, etc.)
4Ô∏è‚É£ IdP redireciona de volta com um code
5Ô∏è‚É£ Seu backend troca o code por tokens
6Ô∏è‚É£ Seu backend cria sess√£o/cookie
7Ô∏è‚É£ Usu√°rio navega normalmente (SSR + HTMX)

üëâ Depois do login:

voc√™ n√£o usa token no frontend

o site funciona como web cl√°ssico com cookie


_____________


Posso sugerir melhorias em dois n√≠veis: ‚Äújeito correto‚Äù (refactor mais estruturado) e ‚Äújeito simples‚Äù (ajustes m√≠nimos), j√° alinhadas com o que vi em config.go.

Melhorias recomendadas (correto vs. simples)

GOOGLE_APPLICATION_CREDENTIALS est√° lido e n√£o usado

Jeito correto: adicionar ao Config (ex.: GoogleCredentialsPath) e validar conforme ambiente; ou mover a valida√ß√£o para o cliente do GCP.
Jeito simples: remover a vari√°vel local (hoje ela est√° ‚Äúunused‚Äù e isso quebra build em Go).
normalizeHost quebra se vier com https://

Jeito correto: usar net/url + net.SplitHostPort para extrair o host com seguran√ßa (e aceitar host com esquema/porta).
Valida√ß√£o de enums (APP_ENV, LOG_LEVEL, LOG_FORMAT)

Jeito correto: Validate() no Config retornando *apperr.AppError com INVALID_ENUM_VALUE e lista de op√ß√µes v√°lidas.
Jeito simples: se inv√°lido, cair no default e logar um aviso (se o logger j√° estiver dispon√≠vel).
Centralizar env keys e obrigat√≥rios

Jeito correto: constantes para chaves + helper requireEnv(keys...) que retorna mapa/struct e acumula faltantes.
Jeito simples: mover as strings para const e manter o bloco atual de missing.
Redis e GCP/Firebase espalhados

Jeito correto: colocar REDIS_URL e GOOGLE_APPLICATION_CREDENTIALS no Config e repassar para os adapters, evitando os.Getenv fora do config.
Jeito simples: manter o Redis como est√°, mas ao menos validar REDIS_URL no Load() quando o app usa Redis.
Estrutura do Config

Jeito correto: sub-structs (GCP, Firebase, App, Log, DB) para clareza e menos duplica√ß√£o (ex.: FirebaseProjectID vindo de GCPProjectID).
Jeito simples: manter struct plano, mas documentar (coment√°rio) o que √© derivado.
Testes

Jeito correto: testes table-driven para Load() com t.Setenv cobrindo defaults e valida√ß√µes.
Jeito simples: um teste m√≠nimo garantindo que falha quando faltam vari√°veis obrigat√≥rias.
Se voc√™ quiser, eu implemento a vers√£o ‚Äúcorreta‚Äù ou ‚Äúsimples‚Äù e ajusto chamadas (ex.: redis client).

Assumptions / Open questions

GOOGLE_APPLICATION_CREDENTIALS √© obrigat√≥rio sempre ou apenas em dev/local?
DOCAI_LABS_PROCESSOR_ID e Firebase web keys s√£o sempre necess√°rios no backend, ou s√≥ em fluxos espec√≠ficos?
